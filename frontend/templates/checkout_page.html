<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
	<title>Checkout page</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap"
		rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap" rel="stylesheet">

	<link rel="stylesheet" href="{% static 'home/css/open-iconic-bootstrap.min.css' %}">
	<link rel="stylesheet" href="{% static 'home/css/animate.css' %}">

	<link rel="stylesheet" href="{% static 'home/css/owl.carousel.min.css' %}">
	<link rel="stylesheet" href="{% static 'home/css/owl.theme.default.min.css' %}">
	<link rel="stylesheet" href="{% static 'home/css/magnific-popup.css' %}">

	<link rel="stylesheet" href="{% static 'home/css/aos.css' %}">

	<link rel="stylesheet" href="{% static 'home/css/ionicons.min.css' %}">

	<link rel="stylesheet" href="{% static 'home/css/bootstrap-datepicker.css' %}">
	<link rel="stylesheet" href="{% static 'home/css/jquery.timepicker.css' %}">


	<link rel="stylesheet" href="{% static 'home/css/flaticon.css' %}">
	<link rel="stylesheet" href="{% static 'home/css/icomoon.css' %}">
	<link rel="stylesheet" href="{% static 'home/css/style.css' %}">
</head>

<body class="goto-here">

	<div class="hero-wrap hero-bread"
		style="background-image: url({% static 'images/online-payment-vector-9299519.jpg' %});">
		<div class="container">
			<div class="row no-gutters slider-text align-items-center justify-content-center">
				<div class="col-md-9 ftco-animate text-center">
					<p class="breadcrumbs"><span class="mr-2"><a href="index.html"></a></span> <span></span></p>
					<h1 class="mb-0 bread">Checkout</h1>
				</div>
			</div>
		</div>
	</div>

	<section class="ftco-section">
		{% if messages %}
    	{% for message in messages %}
        <div class="alert alert-danger">{{ message }}</div>
    	{% endfor %}
		{% endif %}

		<div class="container">
			<div class="row justify-content-center">
				<div class="col-xl-7 ftco-animate">
					<form action="{% url 'User_details' hotels.id %}" class="billing-form" method="post" enctype="multipart/form-data">
						{% csrf_token %}
						<h3 class="mb-4 billing-heading">Billing Details</h3>
						<div class="row align-items-end">
							<div class="col-md-6">
								<div class="form-group">
									<label for="firstname">Name</label>
									<input type="text" class="form-control" placeholder="" name="name">
								</div>
							</div>
							<div class="col-md-6">
							</div>
							<div class="w-100"></div>
							<div class="col-md-12">
								<div class="form-group">
									<label for="country">State</label>
									<div class="select-wrap">
										<div class="icon"><span class="ion-ios-arrow-down"></span></div>
										<select name="state" id="" class="form-control">
											<option>Kerala</option>
											<option>Karnataka</option>
											<option>Himachal Pradesh</option>
											<option>Goa</option>
											<option>Punjab</option>
											<option>Maharashtra</option>
										</select>
									</div>
								</div>
							</div>
							<div class="w-100"></div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="streetaddress">Street Address</label>
									<input type="text" class="form-control" placeholder="House number and street name"
										name="street">
								</div>
							</div>
							<div class="col-md-6">
							</div>
							<div class="w-100"></div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="towncity">Town</label>
									<input type="text" class="form-control" placeholder="" name="town">
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="date">Date</label>
									<input type="date" class="form-control" name="date" id="date">
								</div>
							</div>
							<div class="w-100"></div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="phone">Phone</label>
									<input type="text" class="form-control" placeholder="" name="phone">
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="emailaddress">Email Address</label>
									<input type="text" class="form-control" placeholder="" name="email">
								</div>
							</div>
							<div class="w-100"></div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="travel_way">Travel Way</label>
									<select name="travel_way" class="form-select" id="travel_way">
										<option value="">Select Travel Way</option>
										<option value="Car">Car</option>
										<option value="Bike">Bike</option>
									</select>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="aadhar">Upload Aadhar Card</label>
									<input type="file" class="form-control" name="aadhar" required>
								</div>
							</div>
							
						</div>

						</div>
						<div class="col-xl-5">
						<div class="row mt-5 pt-3">
						<div class="col-md-12 d-flex mb-5">
							<div class="cart-detail cart-total p-3 p-md-4">
								<h2>{{ pkg.spot }}</h2>
								<p>Amount: {{ pkg.amount }}</p>
								{% comment %} {% for hotel in hotels %} {% endcomment %}
								<p class="d-flex">
									<span>Hotel Name: {{ hotels.hotel_name }}</span>
								</p>
								{% comment %} {% endfor %} {% endcomment %}



								<h3 class="billing-heading mb-4">Total Amount</h3>
								<hr>

								<p class="d-flex total-price">
									<span>Total</span>Rs <span id="total_amount">{{ pkg.amount }}</span>
								</p>
								

							</div>
						</div>
						<div class="col-md-12">
						</div>
					</div>
					<button type="submit" id="pay_now" class="btn btn-primary mt-3">Pay Now</button>
				</form>
				</div> <!-- .col-md-8 -->
			</div>
		</div>
	</section> <!-- .section -->

	<section class="ftco-section ftco-no-pt ftco-no-pb py-5 bg-light">
	</section>
	</p>
	</div>
	</div>
	</div>
	</footer>

	<script src="https://checkout.razorpay.com/v1/checkout.js"></script>


	<!-- loader -->
	<div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
			<circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
			<circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
				stroke="#F96D00" />
		</svg></div>
		<script>
			document.addEventListener("DOMContentLoaded", function () {
				// Date min value setting
				let today = new Date().toISOString().split("T")[0];
				document.getElementById("date").setAttribute("min", today);
			
				// Form elements
				const billingForm = document.querySelector(".billing-form");
				const requiredInputs = billingForm.querySelectorAll("input[name='name'], input[name='street'], input[name='town'], input[name='date'], input[name='phone'], input[name='email'], input[name='aadhar']");
				const travelWaySelect = document.getElementById("travel_way");
				const totalAmountSpan = document.getElementById("total_amount");
				const payNowButton = document.getElementById("pay_now");
				
				// Original pricing logic
				const originalAmount = parseFloat(totalAmountSpan.textContent);
				let updatedAmount = originalAmount;
				
				// Function to validate form
				function validateForm() {
					let isValid = true;
					let errorMessage = "";
					
					requiredInputs.forEach(input => {
						if (!input.value.trim()) {
							isValid = false;
							input.classList.add("is-invalid");
							
							// Get field label for error message
							const fieldLabel = input.closest('.form-group').querySelector('label').textContent;
							errorMessage += fieldLabel + " is required. ";
						} else {
							input.classList.remove("is-invalid");
						}
					});
					
					return { isValid, errorMessage };
				}
				
				// Add input event listeners to remove error styling when user types
				requiredInputs.forEach(input => {
					input.addEventListener("input", function() {
						if (this.value.trim()) {
							this.classList.remove("is-invalid");
						}
					});
				});
				
				// Travel way pricing logic
				travelWaySelect.addEventListener("change", function () {
					if (this.value === "Car") {
						updatedAmount = originalAmount + 1499;
					} else if (this.value === "Bike") {
						updatedAmount = originalAmount + 799;
					} else {
						updatedAmount = originalAmount;
					}
					totalAmountSpan.textContent = updatedAmount;
				});
				
				// Payment button handler
				payNowButton.addEventListener("click", function (e) {
					e.preventDefault();
					
					// Validate form
					const { isValid, errorMessage } = validateForm();
					
					if (!isValid) {
						// Create error message element
						const alertDiv = document.createElement("div");
						alertDiv.className = "alert alert-danger mt-3";
						alertDiv.textContent = "Please fill in all required fields: " + errorMessage;
						
						// Remove any existing alerts
						const existingAlerts = billingForm.querySelectorAll(".alert");
						existingAlerts.forEach(alert => alert.remove());
						
						// Add alert before the form
						billingForm.prepend(alertDiv);
						
						// Scroll to the top of the form
						billingForm.scrollIntoView({ behavior: "smooth" });
						return;
					}
					
					// If form is valid, proceed with payment
					var options = {
						"key": "rzp_test_IzIBFTmzd3zzKk",
						"amount": updatedAmount * 100,
						"currency": "INR",
						"name": "Tour Package",
						"description": "Payment for tour booking",
						"image": "https://example.com/your_logo.jpg",
						"handler": function (response) {
							billingForm.submit();
						},
						"prefill": {
							"name": document.querySelector("input[name='name']").value,
							"email": document.querySelector("input[name='email']").value,
							"contact": document.querySelector("input[name='phone']").value
						},
						"theme": {
							"color": "#3399cc"
						}
					};
					var rzp = new Razorpay(options);
					rzp.open();
				});
			});
			
			</script>
			

	<script src="{% static 'home/js/jquery.min.js' %}"></script>
	<script src="{% static 'home/js/jquery-migrate-3.0.1.min.js' %}"></script>
	<script src="{% static 'home/js/popper.min.js' %}"></script>
	<script src="{% static 'home/js/bootstrap.min.js' %}"></script>
	<script src="{% static 'home/js/jquery.easing.1.3.js' %}"></script>
	<script src="{% static 'home/js/jquery.waypoints.min.js' %}"></script>
	<script src="{% static 'home/js/jquery.stellar.min.js' %}"></script>
	<script src="{% static 'home/js/owl.carousel.min.js' %}"></script>
	<script src="{% static 'home/js/jquery.magnific-popup.min.js' %}"></script>
	<script src="{% static 'home/js/aos.js' %}"></script>
	<script src="{% static 'home/js/jquery.animateNumber.min.js' %}"></script>
	<script src="{% static 'home/js/bootstrap-datepicker.js' %}"></script>
	<script src="{% static 'home/js/scrollax.min.js' %}"></script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
	<script src="{% static 'home/js/google-map.js' %}"></script>
	<script src="{% static 'home/js/main.js' %}"></script>

</body>

</html>